# ğŸ“ ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾ Grafana Ğ´Ğ»Ñ Ğ²Ğ°ÑˆĞµĞ³Ğ¾ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

ğŸ“ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ğ¾ Ğ¸Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ñ
ĞĞµĞ´ĞµĞ»Ñ 1: ĞÑĞ½Ğ¾Ğ²Ñ‹
âœ… Ğ˜Ğ·ÑƒÑ‡Ğ¸Ñ‚Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Grafana
âœ… ĞŸĞ¾Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºÑƒĞ¹Ñ‚ĞµÑÑŒ Ñ Explore
âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´
âœ… Ğ˜Ğ·ÑƒÑ‡Ğ¸Ñ‚Ğµ LogQL Ğ¸Ğ· ÑˆĞ¿Ğ°Ñ€Ğ³Ğ°Ğ»ĞºĞ¸
ĞĞµĞ´ĞµĞ»Ñ 2: ĞŸÑ€Ğ°ĞºÑ‚Ğ¸ĞºĞ°
âœ… Ğ’Ğ½ĞµĞ´Ñ€Ğ¸Ñ‚Ğµ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
âœ… Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Trace ID
âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ 3-5 Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğ¾Ğ²
âœ… ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹
ĞĞµĞ´ĞµĞ»Ñ 3: ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ğ¾Ğµ
âœ… Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Prometheus
âœ… Ğ¡Ğ¾Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ñ‹ Ğ´Ğ»Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº
âœ… Ğ˜Ğ·ÑƒÑ‡Ğ¸Ñ‚Ğµ distributed tracing

## ğŸ“‹ ĞĞ³Ğ»Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

1. [ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°](#Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°)
2. [Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Grafana](#Ñ‡Ñ‚Ğ¾-Ñ‚Ğ°ĞºĞ¾Ğµ-grafana)
3. [ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Grafana](#Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ-Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸-grafana)
4. [ĞŸÑ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾](#Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ-Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾)
5. [ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğµ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸](#Ğ¿Ñ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğµ-Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸)
6. [Best Practices](#best-practices)

---

## ğŸ“Š ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

### âœ… Ğ¡Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñ‹

**1. ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²**

- âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ° ÑĞµÑ€Ğ²Ğ¸ÑÑ‹: Gateway, User, Product, Order, Cart
- âœ… Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ PostgreSQL Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ° (Database per Service pattern)
- âœ… Kafka Ğ´Ğ»Ñ Ğ°ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ
- âœ… gRPC Ğ´Ğ»Ñ ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ½Ñ‹Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ¾Ğ² (Product Service)
- âœ… Redis Ğ´Ğ»Ñ ĞºÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

**2. Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ**

- âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ñ‹Ğ¹ ÑÑ‚ĞµĞº: Loki + Promtail + Grafana
- âœ… ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑĞ±Ğ¾Ñ€ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¸Ğ· Ğ²ÑĞµÑ… Docker ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ²
- âœ… Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
- âœ… ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° retention (7 Ğ´Ğ½ĞµĞ¹ Ğ´Ğ»Ñ dev)

**3. Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°**

- âœ… Docker Compose Ğ´Ğ»Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸
- âœ… ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ dev Ğ¸ logging
- âœ… Health checks Ğ´Ğ»Ñ ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
- âœ… Volumes Ğ´Ğ»Ñ Ğ¿ĞµÑ€ÑĞ¸ÑÑ‚ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

**4. Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ**

- âœ… ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¸ Ğ² docker-compose Ñ„Ğ°Ğ¹Ğ»Ğ°Ñ…
- âœ… ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ³Ğ°Ğ¹Ğ´Ñ‹ Ğ¿Ğ¾ Kafka, gRPC, Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸ÑĞ¼
- âœ… Ğ ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

### âš ï¸ ĞĞ±Ğ»Ğ°ÑÑ‚Ğ¸ Ğ´Ğ»Ñ ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ

**1. Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² ĞºĞ¾Ğ´Ğµ**

```typescript
// Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ (Ğ¸Ğ· Ğ²Ğ°ÑˆĞ¸Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²):
console.log('âœ… ĞĞ°Ğ¹Ğ´ĞµĞ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ:', user.email);

// ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹:
// - ĞĞµ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ (ÑĞ»Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ°Ñ€ÑĞ¸Ñ‚ÑŒ)
// - ĞĞµÑ‚ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
// - ĞĞµÑ‚ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° (traceId, userId)
// - Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ»Ğ¾Ğ¼Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³
```

**Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ:** ĞŸĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğ½Ğ° ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (ÑĞ¼. Ñ€Ğ°Ğ·Ğ´ĞµĞ» Ğ½Ğ¸Ğ¶Ğµ)

**2. ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº**

- âŒ ĞĞµÑ‚ Prometheus Ğ´Ğ»Ñ ÑĞ±Ğ¾Ñ€Ğ° Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº (CPU, Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ, RPS)
- âŒ ĞĞµÑ‚ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ² Ğ² Grafana
- âŒ ĞĞµÑ‚ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğ¾Ğ² Ğ´Ğ»Ñ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº

**3. Tracing**

- âŒ ĞĞµÑ‚ Ñ€Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ñ€ĞµĞ¹ÑĞ¸Ğ½Ğ³Ğ° (Jaeger/Tempo)
- âŒ Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾Ñ‚ÑĞ»ĞµĞ´Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ñ‡ĞµÑ€ĞµĞ· Ğ²ÑĞµ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

**4. Security**

- âš ï¸ Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ğ´ Ğ¿Ğ°Ñ€Ğ¾Ğ»ĞµĞ¹ Ğ² docker-compose (Ğ´Ğ»Ñ dev Ğ¾Ğº, Ğ½Ğ¾ Ğ´Ğ»Ñ prod Ğ½ÑƒĞ¶Ğ½Ñ‹ secrets)
- âš ï¸ auth_enabled: false Ğ² Loki

### ğŸ¯ ĞÑ†ĞµĞ½ĞºĞ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°: **8/10**

**Ğ§Ñ‚Ğ¾ Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾:**

- ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
- Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- ĞšĞ°Ñ‡ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

**Ğ§Ñ‚Ğ¾ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ:**

- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Prometheus + Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
- Ğ’Ğ½ĞµĞ´Ñ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ distributed tracing
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ñ‹ Ğ² Grafana

---

## ğŸ¨ Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ Grafana

**Grafana** â€” ÑÑ‚Ğ¾ open-source Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ´Ğ»Ñ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…. Ğ­Ñ‚Ğ¾ ĞºĞ°Ğº "Google Analytics" Ğ´Ğ»Ñ Ğ²Ğ°ÑˆĞµĞ¹ Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹.

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ½Ñ†ĞµĞ¿Ñ†Ğ¸Ğ¸:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GRAFANA                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Dashboards (Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ñ‹)                â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚   Panel 1  â”‚  â”‚   Panel 2  â”‚              â”‚   â”‚
â”‚  â”‚  â”‚  (Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº)  â”‚  â”‚  (Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°) â”‚              â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                       â†“                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Data Sources (Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)         â”‚   â”‚
â”‚  â”‚  â€¢ Loki (Ğ»Ğ¾Ğ³Ğ¸)                               â”‚   â”‚
â”‚  â”‚  â€¢ Prometheus (Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸)                      â”‚   â”‚
â”‚  â”‚  â€¢ PostgreSQL (Ğ‘Ğ”)                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ğ’ Ğ²Ğ°ÑˆĞµĞ¼ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ:

- **Loki** â€” Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ»Ğ¾Ğ³Ğ¸ Ğ²ÑĞµÑ… Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
- **Promtail** â€” ÑĞ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ»Ğ¾Ğ³Ğ¸ Ğ¸Ğ· Docker ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ²
- **Grafana** â€” Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ğ»Ğ¾Ğ³Ğ¸ Ğ¸ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¸Ñ… Ğ¸ÑĞºĞ°Ñ‚ÑŒ

---

## ğŸš€ ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸ Grafana

### 1. **Explore (Ğ˜ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ»Ğ¾Ğ³Ğ¾Ğ²)** ğŸ”

Ğ­Ñ‚Ğ¾ Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ².

**ĞšĞ°Ğº Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ:**

1. ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Grafana: http://localhost:3001
2. Ğ›Ğ¾Ğ³Ğ¸Ğ½: `admin`, ĞŸĞ°Ñ€Ğ¾Ğ»ÑŒ: `admin`
3. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ¸ĞºĞ¾Ğ½ĞºÑƒ ĞºĞ¾Ğ¼Ğ¿Ğ°ÑĞ° ÑĞ»ĞµĞ²Ğ° (Explore)
4. Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…: **Loki**

**Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹:**

```logql
# Ğ’ÑĞµ Ğ»Ğ¾Ğ³Ğ¸ Gateway ÑĞµÑ€Ğ²Ğ¸ÑĞ°
{service="gateway-app-dev"}

# Ğ’ÑĞµ Ğ»Ğ¾Ğ³Ğ¸ Ğ²ÑĞµÑ… Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
{service=~".*-app-dev"}

# Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
{service=~".*-app-dev"} |~ "(?i)error|exception|failed"

# Ğ›Ğ¾Ğ³Ğ¸ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ°
{container="app-dev"}

# Ğ›Ğ¾Ğ³Ğ¸ Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
{service="cart-app-dev"} [5m]
```

**Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€Ñ‹:**

```logql
# Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ ÑĞ»Ğ¾Ğ²Ğ¾ "user"
{service="app-dev"} |= "user"

# ĞĞ• ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ ÑĞ»Ğ¾Ğ²Ğ¾ "debug"
{service="app-dev"} != "debug"

# Regex Ğ¿Ğ¾Ğ¸ÑĞº
{service="app-dev"} |~ "userId.*\\d+"

# ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ JSON
{service="app-dev"} | json | level="error"
```

### 2. **Dashboards (Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ñ‹)** ğŸ“Š

Ğ”Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ñ‹ â€” ÑÑ‚Ğ¾ ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ğ¸ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¾Ğ² Ğ¸ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ† Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°.

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğ°:**

1. Dashboards â†’ New Dashboard
2. Add visualization
3. Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Loki
4. ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
5. Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚Ğ¸Ğ¿ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ¿Ğ°Ğ½ĞµĞ»ĞµĞ¹:**

#### A. ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ¿Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼

```logql
sum(count_over_time({service=~".*-app-dev"} |~ "(?i)error" [5m])) by (service)
```

**Ğ¢Ğ¸Ğ¿ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:** Time series (Ğ³Ñ€Ğ°Ñ„Ğ¸Ğº)

#### B. Ğ¢Ğ¾Ğ¿-10 Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ñ… Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº

```logql
{service=~".*-app-dev"} |~ "(?i)error"
```

**Ğ¢Ğ¸Ğ¿ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:** Logs (Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ²)

#### C. ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ (RPS)

```logql
sum(rate({service="gateway-app-dev"} [1m]))
```

**Ğ¢Ğ¸Ğ¿ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:** Stat (Ğ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ Ñ†Ğ¸Ñ„Ñ€Ğ°)

#### D. Ğ Ğ°ÑĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ÑƒÑ€Ğ¾Ğ²Ğ½ĞµĞ¹ Ğ»Ğ¾Ğ³Ğ¾Ğ²

```logql
sum(count_over_time({service=~".*-app-dev"} [5m])) by (level)
```

**Ğ¢Ğ¸Ğ¿ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:** Pie chart (ĞºÑ€ÑƒĞ³Ğ¾Ğ²Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°)

### 3. **Alerting (ĞĞ»ĞµÑ€Ñ‚Ñ‹)** ğŸš¨

ĞĞ»ĞµÑ€Ñ‚Ñ‹ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ÑÑÑ‚ Ğ²Ğ°Ñ Ğ¾ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°Ñ….

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: ĞĞ»ĞµÑ€Ñ‚ Ğ½Ğ° Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº**

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼:

```logql
sum(count_over_time({service=~".*-app-dev"} |~ "(?i)error" [5m]))
```

2. ĞŸĞµÑ€ĞµĞ¹Ğ´Ğ¸Ñ‚Ğµ Ğ² Alert â†’ Create alert rule
3. Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ: `WHEN last() OF query(A) IS ABOVE 10`
4. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ (Email, Slack, Telegram)

### 4. **Variables (ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ)** ğŸ”§

ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ´ĞµĞ»Ğ°ÑÑ‚ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ñ‹ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼Ğ¸.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑĞµÑ€Ğ²Ğ¸ÑĞ°**

1. Dashboard settings â†’ Variables â†’ New variable
2. Name: `service`
3. Type: Query
4. Query: `label_values(service)`
5. Data source: Loki

Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ² Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°Ñ… Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ:

```logql
{service="$service"}
```

Ğ˜ ÑĞ²ĞµÑ€Ñ…Ñƒ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğ° Ğ¿Ğ¾ÑĞ²Ğ¸Ñ‚ÑÑ dropdown Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° ÑĞµÑ€Ğ²Ğ¸ÑĞ°!

### 5. **Annotations (ĞĞ½Ğ½Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ğ¸)** ğŸ“Œ

ĞĞ½Ğ½Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ğ¸ â€” ÑÑ‚Ğ¾ Ğ¼ĞµÑ‚ĞºĞ¸ Ğ½Ğ° Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ°Ñ… (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, "Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹", "Ñ€ĞµĞ»Ğ¸Ğ·").

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**

1. Dashboard settings â†’ Annotations â†’ New annotation
2. Name: "Deployments"
3. Query: `{service="gateway-app-dev"} |= "Application started"`

ĞĞ° Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ°Ñ… Ğ¿Ğ¾ÑĞ²ÑÑ‚ÑÑ Ğ²ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ»Ğ¸Ğ½Ğ¸Ğ¸ Ğ² Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚Ñ‹ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ.

### 6. **Templating (Ğ¨Ğ°Ğ±Ğ»Ğ¾Ğ½Ñ‹)** ğŸ“

Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ¿ĞµÑ€ĞµĞ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ğµ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ñ‹.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²**

```logql
# ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ $service Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ÑÑ Ğ¸Ğ· dropdown
{service="$service"} |~ "$search_term"
```

### 7. **Transformations (Ğ¢Ñ€Ğ°Ğ½ÑÑ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸)** ğŸ”„

ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ğ¹Ñ‚Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€ĞµĞ´ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹.

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:**

- **Filter by value** â€” Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ > 100
- **Group by** â€” ÑĞ³Ñ€ÑƒĞ¿Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾ Ğ¿Ğ¾Ğ»Ñ
- **Calculate field** â€” Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ğ¾Ğµ Ğ¿Ğ¾Ğ»Ğµ
- **Join** â€” Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ· Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

---

## ğŸ¯ ĞŸÑ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 1: ĞŸĞ¾Ğ¸ÑĞº Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ğ² Cart Service

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:** ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¶Ğ°Ğ»ÑƒĞµÑ‚ÑÑ, Ñ‡Ñ‚Ğ¾ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€ Ğ² ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ñƒ.

**Ğ¨Ğ°Ğ³Ğ¸:**

1. ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Explore
2. Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ:

```logql
{service="cart-app-dev"} |~ "(?i)error|exception" | json
```

3. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ´Ğ¸Ğ°Ğ¿Ğ°Ğ·Ğ¾Ğ½: Last 15 minutes
4. ĞĞ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€:

```json
{
  "level": "error",
  "message": "gRPC call failed",
  "service": "cart-service",
  "error": "Product not found"
}
```

5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Product Service:

```logql
{service="product-app-dev"} |= "Product not found"
```

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 2: ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:** Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ²ÑĞµÑ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ².

**Ğ¨Ğ°Ğ³Ğ¸:**

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´: "Microservices Overview"

2. **ĞŸĞ°Ğ½ĞµĞ»ÑŒ 1: ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¿Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼**

```logql
sum(count_over_time({service=~".*-app-dev"} [5m])) by (service)
```

Ğ¢Ğ¸Ğ¿: Time series

3. **ĞŸĞ°Ğ½ĞµĞ»ÑŒ 2: ĞÑˆĞ¸Ğ±ĞºĞ¸ Ğ¿Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼**

```logql
sum(count_over_time({service=~".*-app-dev"} |~ "(?i)error" [5m])) by (service)
```

Ğ¢Ğ¸Ğ¿: Bar chart

4. **ĞŸĞ°Ğ½ĞµĞ»ÑŒ 3: ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸**

```logql
{service=~".*-app-dev"} |~ "(?i)error"
```

Ğ¢Ğ¸Ğ¿: Logs

5. **ĞŸĞ°Ğ½ĞµĞ»ÑŒ 4: Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²**

```logql
{service=~".*-app-dev"} |= "Application started"
```

Ğ¢Ğ¸Ğ¿: Stat (Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚, ĞºĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ€Ğ°Ğ· Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ğ»ÑÑ ÑĞµÑ€Ğ²Ğ¸Ñ)

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 3: ĞÑ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° Ñ‡ĞµÑ€ĞµĞ· Ğ²ÑĞµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:** ĞŸÑ€Ğ¾ÑĞ»ĞµĞ´Ğ¸Ñ‚ÑŒ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°ĞºĞ°Ğ·Ğ° Ğ¾Ñ‚ Gateway Ğ´Ğ¾ Order Service.

**ĞŸÑ€ĞµĞ´Ğ²Ğ°Ñ€Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾:** Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ traceId Ğ² Ğ»Ğ¾Ğ³Ğ¸ (ÑĞ¼. LOGGING_GUIDE.md)

**Ğ¨Ğ°Ğ³Ğ¸:**

1. ĞĞ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ traceId Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ… Gateway:

```logql
{service="gateway-app-dev"} |= "/orders" | json | traceId != ""
```

2. Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ traceId, Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: `abc-123-def-456`

3. ĞĞ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ğ²ÑĞµ Ğ»Ğ¾Ğ³Ğ¸ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°:

```logql
{service=~".*-app-dev"} |= "abc-123-def-456" | json
```

4. Ğ£Ğ²Ğ¸Ğ´Ğ¸Ñ‚Ğµ Ğ¿ÑƒÑ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°:

```
Gateway â†’ Order Service â†’ Product Service (gRPC) â†’ Kafka
```

### Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 4: ĞĞ½Ğ°Ğ»Ğ¸Ğ· Kafka ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹

**Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ°:** ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ñ‡Ñ‚Ğ¾ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ğ² Kafka.

**Ğ¨Ğ°Ğ³Ğ¸:**

1. Ğ›Ğ¾Ğ³Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹:

```logql
{service=~".*-app-dev"} |= "Kafka" |= "published" | json
```

2. Ğ›Ğ¾Ğ³Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹:

```logql
{service=~".*-app-dev"} |= "Kafka" |= "consumed" | json
```

3. ĞÑˆĞ¸Ğ±ĞºĞ¸ Kafka:

```logql
{service=~".*-app-dev"} |= "Kafka" |~ "(?i)error|failed"
```

---

## ğŸ”¥ ĞŸÑ€Ğ¾Ğ´Ğ²Ğ¸Ğ½ÑƒÑ‚Ñ‹Ğµ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ¸

### 1. LogQL â€” ÑĞ·Ñ‹Ğº Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Loki

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°:**

```logql
{label_selector} | line_filter | parser | label_filter | aggregation
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:**

```logql
# 1. Label selector (Ğ²Ñ‹Ğ±Ğ¾Ñ€ Ğ¿Ğ¾Ñ‚Ğ¾ĞºĞ° Ğ»Ğ¾Ğ³Ğ¾Ğ²)
{service="app-dev", level="error"}

# 2. Line filter (Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğ¼Ñƒ)
{service="app-dev"} |= "user" != "debug"

# 3. Parser (Ğ¿Ğ°Ñ€ÑĞ¸Ğ½Ğ³ Ğ»Ğ¾Ğ³Ğ¾Ğ²)
{service="app-dev"} | json | level="error"

# 4. Label filter (Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€ Ğ¿Ğ¾ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ½Ñ‹Ğ¼ Ğ¿Ğ¾Ğ»ÑĞ¼)
{service="app-dev"} | json | userId="123"

# 5. Aggregation (Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ)
sum(count_over_time({service="app-dev"} [5m]))
```

### 2. ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¸Ğ· Ğ»Ğ¾Ğ³Ğ¾Ğ²

Loki Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¸Ğ· Ğ»Ğ¾Ğ³Ğ¾Ğ²!

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:**

```logql
# ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ² ÑĞµĞºÑƒĞ½Ğ´Ñƒ
rate({service="gateway-app-dev"} [1m])

# ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ·Ğ° 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
count_over_time({service=~".*-app-dev"} |~ "error" [5m])

# Ğ¡Ñ€ĞµĞ´Ğ½ĞµĞµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¿Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼
avg(rate({service=~".*-app-dev"} [5m])) by (service)

# ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚Ğ¸Ğ»ÑŒ 95 Ğ´Ğ»Ñ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° (ĞµÑĞ»Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚Ğµ)
quantile_over_time(0.95, {service="gateway-app-dev"}
  | json
  | unwrap duration [5m])
```

### 3. ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ñ… Ğ»Ğ¾Ğ³Ğ¾Ğ²

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 1: ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ JSON**

```logql
{service="app-dev"}
| json
| level="error"
| line_format "{{.timestamp}} [{{.level}}] {{.message}}"
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 2: ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ñ regex**

```logql
{service="app-dev"}
| regexp "userId=(?P<userId>\\d+)"
| userId="123"
```

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ 3: Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ñ‡Ğ¸ÑĞµĞ»**

```logql
{service="gateway-app-dev"}
| regexp "duration: (?P<duration>\\d+)ms"
| unwrap duration
| avg_over_time([5m])
```

### 4. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğ¾Ğ²

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğ°:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Microservices Monitoring Dashboard              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Service: All â–¼]  [Time: Last 1h â–¼]  [ğŸ”„ Refresh] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   RPS    â”‚  â”‚  Errors  â”‚  â”‚  Uptime  â”‚          â”‚
â”‚  â”‚   1.2k   â”‚  â”‚    12    â”‚  â”‚  99.9%   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Requests per Second by Service             â”‚   â”‚
â”‚  â”‚  [Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº Ğ»Ğ¸Ğ½Ğ¸Ğ¹]                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Error Rate      â”‚  â”‚  Latest Errors       â”‚   â”‚
â”‚  â”‚  [Bar chart]     â”‚  â”‚  [Logs table]        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ğ°Ğ½ĞµĞ»ĞµĞ¹:**

1. **Ğ¦Ğ²ĞµÑ‚Ğ°:**

   - Ğ—ĞµĞ»ĞµĞ½Ñ‹Ğ¹: OK
   - Ğ–ĞµĞ»Ñ‚Ñ‹Ğ¹: Warning
   - ĞšÑ€Ğ°ÑĞ½Ñ‹Ğ¹: Error

2. **Thresholds (ĞŸĞ¾Ñ€Ğ¾Ğ³Ğ¸):**

   - Error rate < 1% â€” Ğ·ĞµĞ»ĞµĞ½Ñ‹Ğ¹
   - Error rate 1-5% â€” Ğ¶ĞµĞ»Ñ‚Ñ‹Ğ¹
   - Error rate > 5% â€” ĞºÑ€Ğ°ÑĞ½Ñ‹Ğ¹

3. **Ğ•Ğ´Ğ¸Ğ½Ğ¸Ñ†Ñ‹ Ğ¸Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ:**
   - Requests: `short` (1.2k, 1.5M)
   - Time: `ms`, `s`
   - Bytes: `bytes`

### 5. Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Prometheus (Ğ±Ğ¾Ğ½ÑƒÑ)

Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Prometheus Ğ´Ğ»Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº:

```yaml
# docker-compose.monitoring.yml
services:
  prometheus:
    image: prom/prometheus:latest
    ports:
      - '9090:9090'
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
```

```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'nodejs'
    static_configs:
      - targets: ['gateway-app-dev:3000', 'app-dev:5000']
```

Ğ’ NestJS Ğ´Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ:

```bash
npm install @willsoto/nestjs-prometheus prom-client
```

```typescript
// app.module.ts
import { PrometheusModule } from '@willsoto/nestjs-prometheus';

@Module({
  imports: [PrometheusModule.register()],
})
export class AppModule {}
```

Ğ¢ĞµĞ¿ĞµÑ€ÑŒ Ğ² Grafana Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Prometheus ĞºĞ°Ğº Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº!

---

## ğŸ’¡ Best Practices

### 1. Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

**Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ custom logger:**

```typescript
// src/common/logger/structured-logger.ts
import { Logger } from '@nestjs/common';

export class StructuredLogger {
  private logger: Logger;

  constructor(private context: string) {
    this.logger = new Logger(context);
  }

  info(message: string, data?: Record<string, any>) {
    this.logger.log(
      JSON.stringify({
        level: 'info',
        service: this.context,
        message,
        timestamp: new Date().toISOString(),
        ...data,
      }),
    );
  }

  error(message: string, error?: Error, data?: Record<string, any>) {
    this.logger.error(
      JSON.stringify({
        level: 'error',
        service: this.context,
        message,
        error: error?.message,
        stack: error?.stack,
        timestamp: new Date().toISOString(),
        ...data,
      }),
    );
  }

  warn(message: string, data?: Record<string, any>) {
    this.logger.warn(
      JSON.stringify({
        level: 'warn',
        service: this.context,
        message,
        timestamp: new Date().toISOString(),
        ...data,
      }),
    );
  }

  debug(message: string, data?: Record<string, any>) {
    if (process.env.NODE_ENV === 'development') {
      this.logger.debug(
        JSON.stringify({
          level: 'debug',
          service: this.context,
          message,
          timestamp: new Date().toISOString(),
          ...data,
        }),
      );
    }
  }
}
```

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ:**

```typescript
// users.service.ts
import { StructuredLogger } from './common/logger/structured-logger';

export class UsersService {
  private logger = new StructuredLogger('UsersService');

  async createUser(dto: CreateUserDto) {
    this.logger.info('Creating user', { email: dto.email });

    try {
      const user = await this.userRepository.save(dto);

      this.logger.info('User created successfully', {
        userId: user.id,
        email: user.email,
      });

      return user;
    } catch (error) {
      this.logger.error('Failed to create user', error, {
        email: dto.email,
      });
      throw error;
    }
  }
}
```

### 2. Trace ID Ğ´Ğ»Ñ Ğ¾Ñ‚ÑĞ»ĞµĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

**Middleware Ğ´Ğ»Ñ Gateway:**

```typescript
// src/common/middleware/trace-id.middleware.ts
import { Injectable, NestMiddleware } from '@nestjs/common';
import { Request, Response, NextFunction } from 'express';
import { randomUUID } from 'crypto';

@Injectable()
export class TraceIdMiddleware implements NestMiddleware {
  use(req: Request, res: Response, next: NextFunction) {
    const traceId = (req.headers['x-trace-id'] as string) || randomUUID();
    req['traceId'] = traceId;
    res.setHeader('x-trace-id', traceId);
    next();
  }
}
```

**Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ middleware:**

```typescript
// app.module.ts
export class AppModule implements NestModule {
  configure(consumer: MiddlewareConsumer) {
    consumer.apply(TraceIdMiddleware).forRoutes('*');
  }
}
```

**Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ…:**

```typescript
this.logger.info('Processing request', {
  traceId: req['traceId'],
  method: req.method,
  url: req.url,
});
```

### 3. Ğ§Ñ‚Ğ¾ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ

**âœ… ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾:**

- ĞĞ°Ñ‡Ğ°Ğ»Ğ¾ Ğ¸ ĞºĞ¾Ğ½ĞµÑ† Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°
- ĞÑˆĞ¸Ğ±ĞºĞ¸ Ğ¸ Ğ¸ÑĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
- Ğ’Ğ°Ğ¶Ğ½Ñ‹Ğµ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
- Ğ’Ñ‹Ğ·Ğ¾Ğ²Ñ‹ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
- Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ

**âš ï¸ Ğ¡ Ğ¾ÑÑ‚Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒÑ:**

- ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
- SQL Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹ (Ğ¼Ğ¾Ğ³ÑƒÑ‚ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ)

**âŒ ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ°:**

- ĞŸĞ°Ñ€Ğ¾Ğ»Ğ¸
- Ğ¢Ğ¾ĞºĞµĞ½Ñ‹
- ĞĞ¾Ğ¼ĞµÑ€Ğ° ĞºÑ€ĞµĞ´Ğ¸Ñ‚Ğ½Ñ‹Ñ… ĞºĞ°Ñ€Ñ‚
- API ĞºĞ»ÑÑ‡Ğ¸
- ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (Ğ±ĞµĞ· Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸)

### 4. Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

```typescript
// DEBUG - Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸
this.logger.debug('User query executed', { query, params });

// INFO - Ğ²Ğ°Ğ¶Ğ½Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
this.logger.info('User logged in', { userId, email });

// WARN - Ğ¿Ñ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ
this.logger.warn('Rate limit approaching', { userId, requests: 95 });

// ERROR - Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
this.logger.error('Database connection failed', error);
```

### 5. ĞÑ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğ¾Ğ²

**Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°:**

```
ğŸ“ General
  â””â”€ ğŸ“Š System Overview (CPU, Memory, Disk)

ğŸ“ Microservices
  â”œâ”€ ğŸ“Š Gateway Service
  â”œâ”€ ğŸ“Š User Service
  â”œâ”€ ğŸ“Š Product Service
  â”œâ”€ ğŸ“Š Order Service
  â””â”€ ğŸ“Š Cart Service

ğŸ“ Infrastructure
  â”œâ”€ ğŸ“Š PostgreSQL
  â”œâ”€ ğŸ“Š Redis
  â”œâ”€ ğŸ“Š Kafka
  â””â”€ ğŸ“Š Docker Containers

ğŸ“ Business Metrics
  â”œâ”€ ğŸ“Š User Registrations
  â”œâ”€ ğŸ“Š Orders
  â””â”€ ğŸ“Š Revenue
```

### 6. ĞĞ»ĞµÑ€Ñ‚Ñ‹

**ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹:**

- Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ > 1 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹
- Error rate > 5%
- Response time > 1s
- Disk usage > 90%

**ĞŸÑ€ĞµĞ´ÑƒĞ¿Ñ€ĞµĞ¶Ğ´ĞµĞ½Ğ¸Ñ:**

- Error rate > 1%
- Response time > 500ms
- Memory usage > 80%

---

## ğŸ“ ĞŸÑ€Ğ°ĞºÑ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ

### Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ 1: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ ÑĞ²Ğ¾Ğ¹ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´

1. Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ "My First Dashboard"
3. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ 3 Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸:
   - ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¿Ğ¾ ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ğ¼
   - ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸
   - Ğ“Ñ€Ğ°Ñ„Ğ¸Ğº Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ‡Ğ°Ñ

### Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ 2: Ğ’Ğ½ĞµĞ´Ñ€Ğ¸Ñ‚Ğµ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ `StructuredLogger` Ğ² Ğ¾Ğ´Ğ½Ğ¾Ğ¼ Ğ¸Ğ· ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
2. Ğ—Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ Ğ²ÑĞµ `console.log` Ğ½Ğ° `logger.info`
3. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ñ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼
4. ĞĞ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ ÑÑ‚Ğ¸ Ğ»Ğ¾Ğ³Ğ¸ Ğ² Grafana

### Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ 3: Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Trace ID

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ middleware Ğ´Ğ»Ñ Trace ID Ğ² Gateway
2. ĞŸĞµÑ€ĞµĞ´Ğ°Ğ²Ğ°Ğ¹Ñ‚Ğµ Trace ID Ğ² Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ°Ñ… Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğµ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ… ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ²
3. Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Trace ID Ğ²Ğ¾ Ğ²ÑĞµÑ… ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ñ…
4. ĞĞ°Ğ¹Ğ´Ğ¸Ñ‚Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¿Ğ¾ Trace ID Ğ² Grafana

### Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ 4: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ°Ğ»ĞµÑ€Ñ‚

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ°Ğ»ĞµÑ€Ñ‚ Ğ½Ğ° ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº > 10 Ğ·Ğ° 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
2. ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ² ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ)
3. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ² ĞºĞ¾Ğ´Ğµ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ°Ğ»ĞµÑ€Ñ‚

---

## ğŸ“š ĞŸĞ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹

### Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

- [Grafana Documentation](https://grafana.com/docs/grafana/latest/)
- [Loki Documentation](https://grafana.com/docs/loki/latest/)
- [LogQL Query Language](https://grafana.com/docs/loki/latest/logql/)

### Ğ’Ğ¸Ğ´ĞµĞ¾

- [Grafana Crash Course](https://www.youtube.com/watch?v=QQEa_NlQZCw)
- [Loki Tutorial](https://www.youtube.com/watch?v=h_GGd7HfKQ8)

### Ğ¡Ñ‚Ğ°Ñ‚ÑŒĞ¸

- [Best Practices for Logging](https://www.datadoghq.com/blog/log-management-best-practices/)
- [Observability in Microservices](https://martinfowler.com/articles/microservices.html)

---

## ğŸ¯ Ğ¡Ğ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ ÑˆĞ°Ğ³Ğ¸

1. âœ… Ğ˜Ğ·ÑƒÑ‡Ğ¸Ñ‚Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Grafana (Explore, Dashboards)
2. âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ ÑĞ²Ğ¾Ğ¹ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´
3. ğŸ”„ Ğ’Ğ½ĞµĞ´Ñ€Ğ¸Ñ‚Ğµ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
4. ğŸ”„ Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Trace ID
5. ğŸ”„ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹
6. ğŸ”„ Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Prometheus Ğ´Ğ»Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº
7. ğŸ”„ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹Ñ‚Ğµ distributed tracing (Jaeger/Tempo)

---

## ğŸ’¬ Ğ’Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹

**Q: Ğ§ĞµĞ¼ Loki Ğ¾Ñ‚Ğ»Ğ¸Ñ‡Ğ°ĞµÑ‚ÑÑ Ğ¾Ñ‚ Elasticsearch?**
A: Loki Ğ¸Ğ½Ğ´ĞµĞºÑĞ¸Ñ€ÑƒĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¼ĞµÑ‚ĞºĞ¸ (labels), Ğ° Ğ½Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ğ»Ğ¾Ğ³Ğ¾Ğ². Ğ­Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚ ĞµĞ³Ğ¾ Ğ»ĞµĞ³Ñ‡Ğµ Ğ¸ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ, Ğ½Ğ¾ Ğ¼ĞµĞ½ĞµĞµ Ğ³Ğ¸Ğ±ĞºĞ¸Ğ¼ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ°.

**Q: ĞÑƒĞ¶Ğ½Ğ¾ Ğ»Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Prometheus, ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ Loki?**
A: Ğ”Ğ°! Loki Ğ´Ğ»Ñ Ğ»Ğ¾Ğ³Ğ¾Ğ², Prometheus Ğ´Ğ»Ñ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº (CPU, Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ, RPS). Ğ­Ñ‚Ğ¾ Ñ€Ğ°Ğ·Ğ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡.

**Q: ĞšĞ°Ğº Ğ´Ğ¾Ğ»Ğ³Ğ¾ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸?**
A: Ğ”Ğ»Ñ dev: 7 Ğ´Ğ½ĞµĞ¹. Ğ”Ğ»Ñ production: 30-90 Ğ´Ğ½ĞµĞ¹ (Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ğ¸ Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ°).

**Q: Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ cardinality Ğ¸ Ğ¿Ğ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾?**
A: Cardinality â€” ÑÑ‚Ğ¾ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ğ¼ĞµÑ‚ĞºĞ¸. Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ cardinality (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€, userId ĞºĞ°Ğº Ğ¼ĞµÑ‚ĞºĞ°) Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ğ¼ĞµĞ´Ğ»Ğ¸Ñ‚ÑŒ Loki. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ Ğ¼ĞµÑ‚ĞºĞ¸ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸, Ğ° Ğ½Ğµ Ğ´Ğ»Ñ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….

---

**Ğ£Ğ´Ğ°Ñ‡Ğ¸ Ğ² Ğ¸Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Grafana! ğŸš€**
