# üì¶ Kafka –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ ‚Äî –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º

## üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ Kafka –≤–æ–æ–±—â–µ?

–ü—Ä–µ–¥—Å—Ç–∞–≤—å **–ø–æ—á—Ç–æ–≤–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ** –≤ –≥–æ—Ä–æ–¥–µ:

- **–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å** (Producer) –ø—Ä–∏–Ω–æ—Å–∏—Ç –ø–∏—Å—å–º–æ –∏ –∫–ª–∞–¥—ë—Ç –µ–≥–æ –≤ **–ø–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫** (Topic)
- **–ü–æ–ª—É—á–∞—Ç–µ–ª—å** (Consumer) –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫ —ç—Ç–æ–º—É —è—â–∏–∫—É –∏ –∑–∞–±–∏—Ä–∞–µ—Ç –ø–∏—Å—å–º–∞
- **–ü–æ—á—Ç–æ–≤–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ** (Kafka) ‚Äî —ç—Ç–æ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç –ø–∏—Å—å–º–∞ –∏ —Å–ª–µ–¥–∏—Ç, —á—Ç–æ–±—ã –≤—Å–µ –ø–æ–ª—É—á–∏–ª–∏ —Å–≤–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è

### –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ?

–í –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö —Å–µ—Ä–≤–∏—Å—ã **–Ω–µ –¥–æ–ª–∂–Ω—ã –Ω–∞–ø—Ä—è–º—É—é –∑–∞–≤–∏—Å–µ—Ç—å –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞**. –ï—Å–ª–∏ `user-service` –±—É–¥–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –≤—ã–∑—ã–≤–∞—Ç—å `cart-service`, —Ç–æ:
- –ï—Å–ª–∏ `cart-service` —É–ø–∞–¥—ë—Ç ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–æ–∂–µ —É–ø–∞–¥—ë—Ç ‚ùå
- –°–µ—Ä–≤–∏—Å—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è "—Å–∫–ª–µ–µ–Ω–Ω—ã–º–∏" –∏ —Å–ª–æ–∂–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—é—Ç—Å—è

–° Kafka:
- `user-service` –ø—Ä–æ—Å—Ç–æ **–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ** "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω" –∏ –∑–∞–±—ã–≤–∞–µ—Ç –ø—Ä–æ —ç—Ç–æ ‚úÖ
- `cart-service` **—Å–∞–º —Ä–µ—à–∞–µ—Ç**, –∫–æ–≥–¥–∞ –∑–∞–±—Ä–∞—Ç—å —ç—Ç–æ —Å–æ–±—ã—Ç–∏–µ –∏ —Å–æ–∑–¥–∞—Ç—å –∫–æ—Ä–∑–∏–Ω—É
- –ï—Å–ª–∏ `cart-service` –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî —Å–æ–±—ã—Ç–∏–µ –ø–æ–¥–æ–∂–¥—ë—Ç –≤ Kafka

---

## üèóÔ∏è –ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ Kafka –≤ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ

### 1Ô∏è‚É£ **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞** (docker-compose.dev.yml)

```
Zookeeper (–ø–æ—Ä—Ç 2181) ‚Üê –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä Kafka
    ‚Üì
Kafka (–ø–æ—Ä—Ç—ã 9092, 9094) ‚Üê —Å–∞–º –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
```

- **Zookeeper** ‚Äî —ç—Ç–æ "–º–æ–∑–≥" Kafka, –∫–æ—Ç–æ—Ä—ã–π —Å–ª–µ–¥–∏—Ç –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –±—Ä–æ–∫–µ—Ä–æ–≤
- **Kafka** ‚Äî —Å–∞–º —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- **–ü–æ—Ä—Ç 9092** ‚Äî –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –≤–Ω—É—Ç—Ä–∏ Docker (–∫–æ–≥–¥–∞ —Å–µ—Ä–≤–∏—Å—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö –æ–±—â–∞—é—Ç—Å—è)
- **–ü–æ—Ä—Ç 9094** ‚Äî –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ —Ç–≤–æ—ë–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ (–∫–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—à—å –ª–æ–∫–∞–ª—å–Ω–æ)

---

### 2Ô∏è‚É£ **–°—Ü–µ–Ω–∞—Ä–∏–π: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

–î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä—ë–º **—Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä** –∏–∑ –∫–æ–¥–∞:

#### **–®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è** 
üë§ –ó–∞–ø—Ä–æ—Å ‚Üí `POST /api/auth/registration`

```typescript
// user-service/src/auth/auth.service.ts (—Å—Ç—Ä–æ–∫–∞ 121-159)

async registration(userDto: CreateUserDto) {
  // 1. –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ
  const user = await this.usersService.createUser(userDto);
  
  // 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ Kafka
  const event = {
    type: 'UserCreated',
    userId: user.id,
    eventId: crypto.randomUUID(),
    occurredAt: new Date().toISOString(),
  };
  
  // 3. –ü—É–±–ª–∏–∫—É–µ–º –≤ —Ç–æ–ø–∏–∫ 'users.events'
  this.kafkaClient.emit(USERS_EVENTS_TOPIC, event);
  
  // 4. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  return this.generateToken(user);
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω –≤ –±–∞–∑–µ `users-service`
2. üì® –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Kafka –≤ —Ç–æ–ø–∏–∫ `users.events`
3. üé´ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª —Ç–æ–∫–µ–Ω –∏ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
4. ‚è≥ Kafka —Ö—Ä–∞–Ω–∏—Ç —Å–æ–±—ã—Ç–∏–µ –∏ –∂–¥—ë—Ç, –ø–æ–∫–∞ –∫—Ç–æ-—Ç–æ –µ–≥–æ –∑–∞–±–µ—Ä—ë—Ç

---

#### **–®–∞–≥ 2: Cart-service —Å–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è**

```typescript
// cart-service/src/kafka/user-events.controller.ts (—Å—Ç—Ä–æ–∫–∞ 53-75)

@EventPattern('users.events')  // ‚Üê –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–æ–ø–∏–∫
async handleUserEvents(@Payload() message: unknown) {
  // 1. –ü–∞—Ä—Å–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ
  const payload = parseKafkaValue(rawValue);
  
  // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è
  if (payload.type !== 'UserCreated') {
    return; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –¥—Ä—É–≥–∏–µ —Å–æ–±—ã—Ç–∏—è
  }
  
  // 3. –°–æ–∑–¥–∞—ë–º –∫–æ—Ä–∑–∏–Ω—É –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const userId = Number(event.userId);
  await this.cartService.ensureCart(userId);
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. üëÇ `cart-service` **–ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–ª—É—à–∞–µ—Ç** —Ç–æ–ø–∏–∫ `users.events`
2. üì¨ –ü–æ–ª—É—á–∏–ª —Å–æ–±—ã—Ç–∏–µ `UserCreated`
3. üõí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–ª –ø—É—Å—Ç—É—é –∫–æ—Ä–∑–∏–Ω—É –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. ‚úÖ –ì–æ—Ç–æ–≤–æ! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞–∂–µ –Ω–µ –∑–Ω–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ

---

### 3Ô∏è‚É£ **–ö–∞–∫ —ç—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ**

#### **–í user-service (Producer ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å)**

```typescript
// user-service/src/kafka/kafka.module.ts

ClientsModule.registerAsync([{
  name: USER_SERVICE_KAFKA_CLIENT,
  useFactory: (config: ConfigService) => ({
    transport: Transport.KAFKA,
    options: {
      client: {
        clientId: 'user-service',
        brokers: ['kafka:9092'], // –ê–¥—Ä–µ—Å Kafka
      },
      consumer: {
        groupId: 'user-service',
      },
    },
  }),
}])
```

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:**
- `user-service` –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Kafka –∫–∞–∫ **–∫–ª–∏–µ–Ω—Ç**
- –ú–æ–∂–µ—Ç **–æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å** —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª—é–±–æ–π —Ç–æ–ø–∏–∫

---

#### **–í cart-service (Consumer ‚Äî –ø–æ–ª—É—á–∞—Ç–µ–ª—å)**

```typescript
// cart-service/src/main.ts (—Å—Ç—Ä–æ–∫–∞ 26-38)

app.connectMicroservice<MicroserviceOptions>({
  transport: Transport.KAFKA,
  options: {
    client: {
      clientId: 'cart-service',
      brokers: ['kafka:9092'],
    },
    consumer: {
      groupId: 'cart-service', // ‚Üê –ì—Ä—É–ø–ø–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π
    },
  },
});
```

**–ü—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏:**
- `cart-service` —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ **–≥–∏–±—Ä–∏–¥–Ω–æ–º —Ä–µ–∂–∏–º–µ**:
  - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã (REST API)
  - –°–ª—É—à–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –∏–∑ Kafka
- `groupId` ‚Äî —ç—Ç–æ –∫–∞–∫ "–∫–æ–º–∞–Ω–¥–∞". –ï—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏—à—å 3 –∫–æ–ø–∏–∏ `cart-service`, –æ–Ω–∏ —Ä–∞–∑–¥–µ–ª—è—Ç —Ä–∞–±–æ—Ç—É –º–µ–∂–¥—É —Å–æ–±–æ–π

---

## üîë –ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ä–º–∏–Ω—ã

| –¢–µ—Ä–º–∏–Ω | –ß—Ç–æ —ç—Ç–æ | –ê–Ω–∞–ª–æ–≥–∏—è |
|--------|---------|----------|
| **Producer** | –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π | –ß–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –∫–ª–∞–¥—ë—Ç –ø–∏—Å—å–º–æ –≤ –ø–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫ |
| **Consumer** | –ü–æ–ª—É—á–∞—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π | –ß–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–±–∏—Ä–∞–µ—Ç –ø–∏—Å—å–º–∞ –∏–∑ —è—â–∏–∫–∞ |
| **Topic** | –ö–∞–Ω–∞–ª –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π | –ü–æ—á—Ç–æ–≤—ã–π —è—â–∏–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, "users.events") |
| **Broker** | –°–µ—Ä–≤–µ—Ä Kafka | –°–∞–º–æ –ø–æ—á—Ç–æ–≤–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ |
| **Group ID** | –ì—Ä—É–ø–ø–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π | –ö–æ–º–∞–Ω–¥–∞ –ø–æ—á—Ç–∞–ª—å–æ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª—è—Ç —Ä–∞–±–æ—Ç—É |
| **Event** | –°–æ–±—ã—Ç–∏–µ | –°–∞–º–æ –ø–∏—Å—å–º–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π |

---

## üìä –°—Ö–µ–º–∞ —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  User Service   ‚îÇ
‚îÇ   (Producer)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ 1. –°–æ–∑–¥–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
         ‚îÇ 2. –û—Ç–ø—Ä–∞–≤–∏–ª —Å–æ–±—ã—Ç–∏–µ
         ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Kafka  ‚îÇ ‚Üê –¢–æ–ø–∏–∫: users.events
    ‚îÇ (Broker)‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ 3. –•—Ä–∞–Ω–∏—Ç —Å–æ–±—ã—Ç–∏–µ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Cart Service   ‚îÇ
‚îÇ   (Consumer)    ‚îÇ ‚Üê 4. –ó–∞–±—Ä–∞–ª —Å–æ–±—ã—Ç–∏–µ
‚îÇ                 ‚îÇ    5. –°–æ–∑–¥–∞–ª –∫–æ—Ä–∑–∏–Ω—É
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéì –ß—Ç–æ –∏–∑—É—á–∞–µ—Ç—Å—è –Ω–∞ —ç—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–µ

### ‚úÖ Kafka
- **Event-Driven Architecture** (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è—Ö)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
- –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å (–µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å —É–ø–∞–ª, —Å–æ–±—ã—Ç–∏–µ –Ω–µ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è)

### ‚ùå gRPC (–ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
–°—É–¥—è –ø–æ –∫–æ–¥—É, **gRPC –ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** –≤ –ø—Ä–æ–µ–∫—Ç–µ. –ï—Å—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ `package.json`, –Ω–æ –Ω–µ—Ç `.proto` —Ñ–∞–π–ª–æ–≤ –∏ gRPC-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤.

**–ß—Ç–æ —Ç–∞–∫–æ–µ gRPC:**
- –≠—Ç–æ —Å–ø–æ—Å–æ–± **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ** –≤—ã–∑–æ–≤–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
- –ë—ã—Å—Ç—Ä–µ–µ —á–µ–º REST (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–∏–Ω–∞—Ä–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª)
- –ù—É–∂–µ–Ω –∫–æ–≥–¥–∞ –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å **–∂–¥—ë—Ç –æ—Ç–≤–µ—Ç–∞** –æ—Ç –¥—Ä—É–≥–æ–≥–æ

**–ü—Ä–∏–º–µ—Ä –≥–¥–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å gRPC:**
```
cart-service —Ö–æ—á–µ—Ç —É–∑–Ω–∞—Ç—å —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞
    ‚Üì (gRPC –≤—ã–∑–æ–≤)
product-service –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ü–µ–Ω—É
    ‚Üì
cart-service –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ—Ä–∑–∏–Ω—É —Å —Ü–µ–Ω–∞–º–∏
```

---

## üÜö Kafka vs gRPC ‚Äî –∫–æ–≥–¥–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

| Kafka | gRPC |
|-------|------|
| ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (fire-and-forget) | ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (–∑–∞–ø—Ä–æ—Å-–æ—Ç–≤–µ—Ç) |
| ‚úÖ –°–æ–±—ã—Ç–∏–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å—Å—è –ø–æ–∑–∂–µ | ‚úÖ –ù—É–∂–µ–Ω –æ—Ç–≤–µ—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å |
| ‚úÖ –ú–Ω–æ–≥–æ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–∞ –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ | ‚úÖ –û–¥–∏–Ω –≤—ã–∑—ã–≤–∞–µ—Ç, –æ–¥–∏–Ω –æ—Ç–≤–µ—á–∞–µ—Ç |
| ‚ùå –ù–µ–ª—å–∑—è –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç —Å—Ä–∞–∑—É | ‚ùå –ï—Å–ª–∏ —Å–µ—Ä–≤–∏—Å —É–ø–∞–ª ‚Üí –æ—à–∏–±–∫–∞ |

**–ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏:**
- **Kafka:** "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è" ‚Üí –≤—Å–µ–º —Å–µ—Ä–≤–∏—Å–∞–º (–∫–æ—Ä–∑–∏–Ω–∞, —Ä–∞—Å—Å—ã–ª–∫–∞, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
- **gRPC:** "–ö–∞–∫–∞—è —Ü–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞ ‚Ññ5?" ‚Üí –Ω—É–∂–µ–Ω –æ—Ç–≤–µ—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å

---

## üéØ –ò—Ç–æ–≥ –ø–æ –ø—Ä–æ–µ–∫—Ç—É

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ **4 –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞** (user, product, order, cart)
2. ‚úÖ **Kafka** –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ **–°–æ–±—ã—Ç–∏–µ UserCreated** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
4. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã** –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### –ß—Ç–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è –æ–±—É—á–µ–Ω–∏—è:
1. üîú **gRPC** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ç–æ–≤–∞—Ä–∞—Ö
2. üîú –ë–æ–ª—å—à–µ —Å–æ–±—ã—Ç–∏–π (OrderCreated, ProductUpdated)
3. üîú –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ retry (–ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏)
4. üîú –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π (—á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ)

---

## ü§î –í–æ–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è

1. **–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç, –µ—Å–ª–∏ `cart-service` –±—É–¥–µ—Ç –≤—ã–∫–ª—é—á–µ–Ω 5 –º–∏–Ω—É—Ç, –∞ –∑–∞ —ç—Ç–æ –≤—Ä–µ–º—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?**
   - –û—Ç–≤–µ—Ç: –°–æ–±—ã—Ç–∏—è –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ Kafka. –ö–æ–≥–¥–∞ `cart-service` –≤–∫–ª—é—á–∏—Ç—Å—è, –æ–Ω –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ 10 —Å–æ–±—ã—Ç–∏–π –∏ —Å–æ–∑–¥–∞—Å—Ç –∫–æ—Ä–∑–∏–Ω—ã.

2. **–ü–æ—á–µ–º—É –≤ `auth.service.ts` –æ—à–∏–±–∫–∞ Kafka –Ω–µ –ª–æ–º–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é?**
   - –û—Ç–≤–µ—Ç: –ü–æ—Ç–æ–º—É —á—Ç–æ `emit()` –æ–±—ë—Ä–Ω—É—Ç –≤ `try/catch`. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è ‚Äî –Ω–µ—Ç.

3. **–ó–∞—á–µ–º –Ω—É–∂–µ–Ω `groupId` –≤ consumer?**
   - –û—Ç–≤–µ—Ç: –ß—Ç–æ–±—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ –º–æ–≥–ª–∏ –¥–µ–ª–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É. Kafka –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –∏–∑ –≥—Ä—É–ø–ø—ã.

---

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–ø–∏–∫–∏ –≤ Kafka
```bash
docker exec -it infra-kafka-1 kafka-topics --list --bootstrap-server localhost:9092
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–æ–ø–∏–∫–µ
```bash
docker exec -it infra-kafka-1 kafka-console-consumer \
  --bootstrap-server localhost:9092 \
  --topic users.events \
  --from-beginning
```

### –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
```bash
docker exec -it infra-kafka-1 kafka-console-producer \
  --bootstrap-server localhost:9092 \
  --topic users.events
```

### –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–æ–ø–∏–∫
```bash
docker exec -it infra-kafka-1 kafka-topics \
  --create \
  --bootstrap-server localhost:9092 \
  --topic new-topic \
  --partitions 3 \
  --replication-factor 1
```

### –£–¥–∞–ª–∏—Ç—å —Ç–æ–ø–∏–∫
```bash
docker exec -it infra-kafka-1 kafka-topics \
  --delete \
  --bootstrap-server localhost:9092 \
  --topic old-topic
```
