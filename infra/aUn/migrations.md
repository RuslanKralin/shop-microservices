# üìö –ö–æ–Ω—Å–ø–µ–∫—Ç: –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ TypeORM

## üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏

**–ú–∏–≥—Ä–∞—Ü–∏—è** = —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –µ—ë —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ –ë–î - —ç—Ç–æ –¥–æ–º:

- **Entity (—Å—É—â–Ω–æ—Å—Ç—å)** - —ç—Ç–æ —á–µ—Ä—Ç—ë–∂ –¥–æ–º–∞ (–∫–∞–∫ –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—å)
- **–ú–∏–≥—Ä–∞—Ü–∏—è** - —ç—Ç–æ –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—è–º (–∫–∞–∫ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å)

### –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏?

‚ùå **–ë–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π (synchronize: true):**

```
–¢—ã –º–µ–Ω—è–µ—à—å Entity ‚Üí TypeORM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç –ë–î
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

- –ú–æ–∂–Ω–æ —Å–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
- –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –û–ø–∞—Å–Ω–æ –Ω–∞ production

‚úÖ **–° –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ (synchronize: false):**

```
–¢—ã –º–µ–Ω—è–µ—à—å Entity ‚Üí –°–æ–∑–¥–∞—ë—à—å –º–∏–≥—Ä–∞—Ü–∏—é ‚Üí –ü—Ä–∏–º–µ–Ω—è–µ—à—å –º–∏–≥—Ä–∞—Ü–∏—é ‚Üí –ë–î –∏–∑–º–µ–Ω–µ–Ω–∞
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- –ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∫–∞–∂–¥—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
- –ò—Å—Ç–æ—Ä–∏—è –≤ git
- –ú–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –Ω–∞ production

---

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

–ö–∞–∂–¥–∞—è –º–∏–≥—Ä–∞—Ü–∏—è - —ç—Ç–æ TypeScript —Ñ–∞–π–ª —Å –¥–≤—É–º—è –º–µ—Ç–æ–¥–∞–º–∏:

```typescript
export class AddStockToProduct1766580221958 implements MigrationInterface {
  name = 'AddStockToProduct1766580221958';

  // ‚¨ÜÔ∏è –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ (–¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É)
  public async up(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.query(
      `ALTER TABLE "products" ADD "stock" integer NOT NULL DEFAULT '0'`,
    );
  }

  // ‚¨áÔ∏è –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ (—É–¥–∞–ª–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É)
  public async down(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.query(`ALTER TABLE "products" DROP COLUMN "stock"`);
  }
}
```

**–ß–∞—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:**

1. **–ò–º—è –∫–ª–∞—Å—Å–∞** - —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Å timestamp
2. **name** - —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –∏–º—è –º–∏–≥—Ä–∞—Ü–∏–∏
3. **up()** - —á—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏
4. **down()** - —á—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ

---

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–¥–µ–ª–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑)

#### 1.1. –°–æ–∑–¥–∞–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é DataSource

–§–∞–π–ª: `src/database/data-source.ts`

```typescript
import { DataSource } from 'typeorm';
import { config } from 'dotenv';

// –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
config({ path: '.development.env' });

export const AppDataSource = new DataSource({
  type: 'postgres',
  host: process.env.DB_HOST,
  port: parseInt(process.env.DB_PORT || '5432'),
  username: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME,
  entities: ['src/**/*.entity.ts'], // –ì–¥–µ –∏—Å–∫–∞—Ç—å Entity
  migrations: ['src/database/migrations/*.ts'], // –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
  synchronize: false, // –í–ê–ñ–ù–û: –≤—ã–∫–ª—é—á–µ–Ω–æ!
});
```

#### 1.2. –î–æ–±–∞–≤—å —Å–∫—Ä–∏–ø—Ç—ã –≤ package.json

```json
{
  "scripts": {
    "migration:generate": "typeorm-ts-node-commonjs migration:generate -d src/database/data-source.ts",
    "migration:create": "typeorm-ts-node-commonjs migration:create",
    "migration:run": "typeorm-ts-node-commonjs migration:run -d src/database/data-source.ts",
    "migration:revert": "typeorm-ts-node-commonjs migration:revert -d src/database/data-source.ts",
    "migration:show": "typeorm-ts-node-commonjs migration:show -d src/database/data-source.ts"
  }
}
```

#### 1.3. –û—Ç–∫–ª—é—á–∏ synchronize –≤ app.module.ts

```typescript
TypeOrmModule.forRootAsync({
  inject: [ConfigService],
  useFactory: (config: ConfigService) => ({
    type: 'postgres',
    host: config.get('DB_HOST'),
    port: config.get<number>('DB_PORT'),
    username: config.get('DB_USER'),
    password: config.get('DB_PASSWORD'),
    database: config.get('DB_NAME'),
    autoLoadEntities: true,
    synchronize: false,              // ‚¨ÖÔ∏è –í—ã–∫–ª—é—á–µ–Ω–æ!
    migrations: ['dist/database/migrations/*.js'],
    migrationsRun: true,             // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  }),
}),
```

---

### –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ë–î)

#### –®–∞–≥ 1: –ò–∑–º–µ–Ω–∏ Entity

–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤—å –Ω–æ–≤–æ–µ –ø–æ–ª–µ:

```typescript
@Entity({ name: 'products' })
export class ProductEntity {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  name: string;

  @Column()
  price: number;

  @Column({ default: 0 })
  stock: number; // ‚¨ÖÔ∏è –ù–û–í–û–ï –ü–û–õ–ï

  @CreateDateColumn()
  createdAt: Date;

  @UpdateDateColumn()
  updatedAt: Date;
}
```

#### –®–∞–≥ 2: –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –º–∏–≥—Ä–∞—Ü–∏—é

```bash
# –ü–µ—Ä–µ–π–¥–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–µ—Ä–≤–∏—Å–∞
cd /path/to/product-service

# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –º–∏–≥—Ä–∞—Ü–∏—é!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
yarn migration:generate src/database/migrations/AddStockToProduct
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. TypeORM –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –ë–î
2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é —Å—Ö–µ–º—É –ë–î —Å —Ç–≤–æ–∏–º–∏ Entity
3. –ù–∞—Ö–æ–¥–∏—Ç —Ä–∞–∑–Ω–∏—Ü—É (–Ω–æ–≤–æ–µ –ø–æ–ª–µ `stock`)
4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
5. –°–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
Migration /path/to/src/database/migrations/1766580221958-AddStockToProduct.ts has been generated successfully.
```

#### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é

–û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª –∏ —É–±–µ–¥–∏—Å—å, —á—Ç–æ SQL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:

```typescript
public async up(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.query(`ALTER TABLE "products" ADD "stock" integer NOT NULL DEFAULT '0'`);
}
```

‚úÖ –í—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!

#### –®–∞–≥ 4: –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é

```bash
yarn migration:run
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. TypeORM —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `migrations` (–µ—Å–ª–∏ –µ—ë –Ω–µ—Ç)
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∫–∞–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
3. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç `up()`)
4. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É `migrations`, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
query: ALTER TABLE "products" ADD "stock" integer NOT NULL DEFAULT '0'
Migration AddStockToProduct1766580221958 has been executed successfully.
```

#### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π

```bash
yarn migration:show
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
[X] AddStockToProduct1766580221958
```

`[X]` = –ø—Ä–∏–º–µ–Ω–µ–Ω–∞  
`[ ]` = –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞

---

### –≠—Ç–∞–ø 3: –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

#### –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é

```bash
yarn migration:revert
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. TypeORM –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é
2. –í—ã–ø–æ–ª–Ω—è–µ—Ç –º–µ—Ç–æ–¥ `down()`
3. –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `migrations`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

```
query: ALTER TABLE "products" DROP COLUMN "stock"
Migration AddStockToProduct1766580221958 has been reverted successfully.
```

#### –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–Ω–æ–≤–∞

```bash
yarn migration:run
```

---

## üéì –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è

**–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `description` –≤ —Ç–∞–±–ª–∏—Ü—É `products`

```typescript
// 1. –ò–∑–º–µ–Ω–∏ Entity
@Column({ nullable: true })
description: string;

// 2. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –º–∏–≥—Ä–∞—Ü–∏—é
yarn migration:generate src/database/migrations/AddDescriptionToProduct

// 3. –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é
yarn migration:run
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ–ª—è

**–ó–∞–¥–∞—á–∞:** –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø `price` —Å `integer` –Ω–∞ `decimal`

```typescript
// 1. –ò–∑–º–µ–Ω–∏ Entity
@Column({ type: 'decimal', precision: 10, scale: 2 })
price: number;

// 2. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –º–∏–≥—Ä–∞—Ü–∏—é
yarn migration:generate src/database/migrations/ChangePriceTypeToDecimal

// 3. –ü—Ä–æ–≤–µ—Ä—å –º–∏–≥—Ä–∞—Ü–∏—é (–º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Ä—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞!)
// 4. –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é
yarn migration:run
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

**–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤–∏—Ç—å —Å–≤—è–∑—å `Product` ‚Üí `Category`

```typescript
// 1. –°–æ–∑–¥–∞–π –Ω–æ–≤—É—é Entity
@Entity({ name: 'categories' })
export class CategoryEntity {
  @PrimaryGeneratedColumn()
  id: number;

  @Column()
  name: string;
}

// 2. –î–æ–±–∞–≤—å —Å–≤—è–∑—å –≤ ProductEntity
@ManyToOne(() => CategoryEntity)
@JoinColumn({ name: 'categoryId' })
category: CategoryEntity;

@Column({ nullable: true })
categoryId: number;

// 3. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –º–∏–≥—Ä–∞—Ü–∏—é
yarn migration:generate src/database/migrations/AddCategoryRelation

// 4. –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é
yarn migration:run
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

**–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ:** –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ TypeORM –Ω–µ –º–æ–∂–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

```bash
# –°–æ–∑–¥–∞–π –ø—É—Å—Ç—É—é –º–∏–≥—Ä–∞—Ü–∏—é
yarn migration:create src/database/migrations/SeedInitialData
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã –∑–∞–ø–æ–ª–Ω—è–µ—à—å –≤—Ä—É—á–Ω—É—é:

```typescript
export class SeedInitialData1766580221958 implements MigrationInterface {
  public async up(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.query(`
            INSERT INTO products (name, price, stock) VALUES
            ('Laptop', 1000, 10),
            ('Mouse', 20, 100),
            ('Keyboard', 50, 50)
        `);
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.query(
      `DELETE FROM products WHERE name IN ('Laptop', 'Mouse', 'Keyboard')`,
    );
  }
}
```

---

## üîç –ö–∞–∫ TypeORM –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

TypeORM —Å–æ–∑–¥–∞—ë—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `migrations`:

```sql
CREATE TABLE migrations (
    id SERIAL PRIMARY KEY,
    timestamp BIGINT NOT NULL,
    name VARCHAR NOT NULL
);
```

**–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ:**

```
| id | timestamp      | name                              |
|----|----------------|-----------------------------------|
| 1  | 1766580221958  | AddStockToProduct1766580221958    |
| 2  | 1766580300000  | AddDescriptionToProduct1766580300000 |
```

–ö–æ–≥–¥–∞ —Ç—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å `yarn migration:run`, TypeORM:

1. –ß–∏—Ç–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `migrations`
2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å —Ñ–∞–π–ª–∞–º–∏ –≤ `src/database/migrations/`
3. –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### ‚úÖ DO (–î–µ–ª–∞–π —Ç–∞–∫):

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é** –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
2. **–ö–æ–º–º–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ git** –≤–º–µ—Å—Ç–µ —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ Entity
3. **–ü—Ä–∏–º–µ–Ω—è–π –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ production** –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞
4. **–ò—Å–ø–æ–ª—å–∑—É–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
5. **–¢–µ—Å—Ç–∏—Ä—É–π –æ—Ç–∫–∞—Ç** –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –Ω–∞ production

### ‚ùå DON'T (–ù–µ –¥–µ–ª–∞–π —Ç–∞–∫):

1. **–ù–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏** - —Å–æ–∑–¥–∞–π –Ω–æ–≤—É—é
2. **–ù–µ —É–¥–∞–ª—è–π —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π** - —ç—Ç–æ –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π `synchronize: true` –Ω–∞ production** - —Ç–æ–ª—å–∫–æ –º–∏–≥—Ä–∞—Ü–∏–∏
4. **–ù–µ –ø—Ä–∏–º–µ–Ω—è–π –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ SQL** - –∏—Å–ø–æ–ª—å–∑—É–π TypeORM CLI
5. **–ù–µ –∑–∞–±—ã–≤–∞–π –ø—Ä–æ –º–µ—Ç–æ–¥ `down()`** - –æ–Ω –Ω—É–∂–µ–Ω –¥–ª—è –æ—Ç–∫–∞—Ç–∞

---

## üöÄ Workflow –≤ –∫–æ–º–∞–Ω–¥–µ

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞:

```bash
# 1. –ü–æ–ª—É—á–∏–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ git
git pull

# 2. –ü—Ä–∏–º–µ–Ω–∏–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –∫–æ–ª–ª–µ–≥
yarn migration:run

# 3. –í–Ω—ë—Å —Å–≤–æ–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ Entity
# ... —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—à—å –∫–æ–¥ ...

# 4. –°–æ–∑–¥–∞–ª –º–∏–≥—Ä–∞—Ü–∏—é
yarn migration:generate src/database/migrations/MyChanges

# 5. –ü—Ä–æ–≤–µ—Ä–∏–ª –º–∏–≥—Ä–∞—Ü–∏—é
yarn migration:show

# 6. –ó–∞–∫–æ–º–º–∏—Ç–∏–ª Entity + –º–∏–≥—Ä–∞—Ü–∏—é
git add .
git commit -m "Add stock field to Product"
git push
```

### Production –¥–µ–ø–ª–æ–π:

```bash
# 1. –î–µ–ø–ª–æ–π –∫–æ–¥–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
git pull

# 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
yarn install

# 3. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
yarn build

# 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π (–ü–ï–†–ï–î –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è!)
yarn migration:run

# 5. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
yarn start:prod
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: synchronize vs –º–∏–≥—Ä–∞—Ü–∏–∏

| –ê—Å–ø–µ–∫—Ç           | synchronize: true | –ú–∏–≥—Ä–∞—Ü–∏–∏                 |
| ---------------- | ----------------- | ------------------------ |
| **–£–¥–æ–±—Å—Ç–≤–æ**     | ‚úÖ –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ   | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∫–æ–º–∞–Ω–¥        |
| **–ö–æ–Ω—Ç—Ä–æ–ª—å**     | ‚ùå –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è   | ‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å       |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | ‚ùå –û–ø–∞—Å–Ω–æ         | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ             |
| **–ò—Å—Ç–æ—Ä–∏—è**      | ‚ùå –ù–µ—Ç            | ‚úÖ –ï—Å—Ç—å –≤ git            |
| **–û—Ç–∫–∞—Ç**        | ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω     | ‚úÖ –í–æ–∑–º–æ–∂–µ–Ω              |
| **Production**   | ‚ùå –ù–ò–ö–û–ì–î–ê        | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ           |
| **–û–±—É—á–µ–Ω–∏–µ**     | ‚úÖ –î–ª—è –Ω–∞—á–∞–ª–∞     | ‚úÖ –î–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ |

---

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

–ü–æ–ø—Ä–æ–±—É–π —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ:

1. **–î–æ–±–∞–≤—å –ø–æ–ª–µ `description` –≤ ProductEntity**
2. **–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –º–∏–≥—Ä–∞—Ü–∏—é**
3. **–ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é**
4. **–ü—Ä–æ–≤–µ—Ä—å –≤ –ë–î, —á—Ç–æ –ø–æ–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ**
5. **–û—Ç–∫–∞—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏—é**
6. **–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø–æ–ª–µ —É–¥–∞–ª–µ–Ω–æ**
7. **–ü—Ä–∏–º–µ–Ω–∏ —Å–Ω–æ–≤–∞**

---

## üìù –®–ø–∞—Ä–≥–∞–ª–∫–∞ –∫–æ–º–∞–Ω–¥

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
yarn migration:generate src/database/migrations/MigrationName

# –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç—É—é –º–∏–≥—Ä–∞—Ü–∏—é (–≤—Ä—É—á–Ω—É—é)
yarn migration:create src/database/migrations/MigrationName

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –Ω–µ–ø—Ä–∏–º–µ–Ω—ë–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
yarn migration:run

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
yarn migration:revert

# –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
yarn migration:show
```

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [TypeORM Migrations Documentation](https://typeorm.io/migrations)
- [TypeORM CLI Commands](https://typeorm.io/using-cli)

---

## üí° –ò—Ç–æ–≥–∏

**–ú–∏–≥—Ä–∞—Ü–∏–∏ - —ç—Ç–æ:**

- ‚úÖ –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ë–î
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –Ω–∞–≤—ã–∫ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

**–ó–∞–ø–æ–º–Ω–∏ –≥–ª–∞–≤–Ω–æ–µ:**

1. –ò–∑–º–µ–Ω–∏–ª Entity ‚Üí –°–æ–∑–¥–∞–π –º–∏–≥—Ä–∞—Ü–∏—é ‚Üí –ü—Ä–∏–º–µ–Ω–∏ –º–∏–≥—Ä–∞—Ü–∏—é
2. –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SQL
3. –ö–æ–º–º–∏—Ç—å Entity –∏ –º–∏–≥—Ä–∞—Ü–∏—é –≤–º–µ—Å—Ç–µ
4. –ù–∞ production —Ç–æ–ª—å–∫–æ –º–∏–≥—Ä–∞—Ü–∏–∏, –Ω–∏–∫–æ–≥–¥–∞ synchronize!

---

**–ê–≤—Ç–æ—Ä:** –¢–≤–æ–π —Ç–∏–º-–ª–∏–¥ –∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å  
**–î–∞—Ç–∞:** 24 –¥–µ–∫–∞–±—Ä—è 2024  
**–ü—Ä–∏–º–µ—Ä:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è `stock` –≤ —Ç–∞–±–ª–∏—Ü—É `products`
